{% extends 'base.html' %}

{% block content %}
<h2>Appointments</h2>

<!-- Add / Edit Appointment Form -->
<form method="POST" {% if edit_appointment %}action="{{ url_for('edit_appointment', id=edit_appointment[0]) }}"{% endif %}>
    <input type="hidden" name="action" value="{{ 'update' if edit_appointment else 'add' }}">
    {% if edit_appointment %}
        <input type="hidden" name="id" value="{{ edit_appointment[0] }}">
    {% endif %}

    <label>Patient:</label>
    <select name="patient_id" required>
        <option value="">Select Patient</option>
        {% for patient in patients %}
            <option value="{{ patient[0] }}" {% if edit_appointment and edit_appointment[1] == patient[0] %}selected{% endif %}>{{ patient[1] }}</option>
        {% endfor %}
    </select>

    <label>Doctor:</label>
    <select name="doctor_id" required>
        <option value="">Select Doctor</option>
        {% for doctor in doctors %}
            <option value="{{ doctor[0] }}" {% if edit_appointment and edit_appointment[2] == doctor[0] %}selected{% endif %}>{{ doctor[1] }}</option>
        {% endfor %}
    </select>

    <label>Date:</label>
    <input type="date" name="date" value="{{ edit_appointment[3] if edit_appointment else '' }}" required>

    <label>Time:</label>
    <input type="time" name="time" value="{{ edit_appointment[4] if edit_appointment else '' }}" required>

    <button type="submit">{{ 'Update Appointment' if edit_appointment else 'Add Appointment' }}</button>
</form>

<hr>

<!-- Appointment List -->
<table border="1">
    <tr>
        <th>ID</th><th>Patient</th><th>Doctor</th><th>Date</th><th>Time</th><th>Actions</th>
    </tr>
    {% for a in appointments %}
    <tr>
        <td>{{ a[0] }}</td>
        <td>{{ a[1] }}</td>
        <td>{{ a[2] }}</td>
        <td>{{ a[3] }}</td>
        <td>{{ a[4] }}</td>
        <td>
            <a href="{{ url_for('edit_appointment', id=a[0]) }}">Edit</a> |
            <a href="{{ url_for('delete_appointment', id=a[0]) }}" onclick="return confirm('Are you sure?')">Delete</a>
        </td>
    </tr>
    {% endfor %}
</table>

{% endblock %}

